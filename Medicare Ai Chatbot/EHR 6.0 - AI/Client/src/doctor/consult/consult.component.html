<div *ngIf="showDiagnose" class="diagnose-container relative top-0 w-full h-full overflow-hidden">
  <div class="diagnose bg-zinc-50 h-full absolute right-0 left-0 top-0 overflow-y-auto p-3">
    <div class="close-btn flex justify-end">
      <button (click)="showDiagnose=!showDiagnose"><i class="fa-solid fa-xmark text-2xl text-red-500"></i></button>
    </div>
    <div class="rec-form w-fit mx-auto bg-blue-50 shadow p-5 rounded-xl">
      <form (ngSubmit)="onConsultPatient()">
        <div class="diagnosis  mb-3">
          <div class="text-lg mb-3">Patient Diagnosis
            <hr>
          </div>
          <textarea [(ngModel)]="medicalDiagnosis.diagnosis" class="w-full md:w-[100%] p-3" cols="30" name="diagnosis"
                    pInputTextarea
                    rows="5">
          </textarea>
        </div>
        <div class="medicines mb-3 w-full">
          <div class="text-lg mb-3">Medicines
            <hr>
          </div>
          <table class="w-full md:w-fit text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400 mb-2"
                 id="medicines_table">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400 p-2">
            <tr class="p-2">
              <th class="px-2 py-3">#</th>
              <th class="px-6 py-3" scope="col">Brand Name</th>
              <th class="px-6 py-3" scope="col">Dosage</th>
              <th class="px-6 py-3" scope="col">Frequency</th>
              <th class="px-6 py-3" scope="col">no.of Days</th>
              <th class="px-6 py-3" scope="col">Remarks</th>
              <th class="px-6 py-3" scope="col">Action</th>
            </tr>
            </thead>
            <tbody>

            <tr *ngFor="let medication of medicalDiagnosis.medicines ;let i = index"
                class="odd:bg-white odd:dark:bg-zinc-300 even:bg-zinc-400 border-b text-black">
              <td class="px-2 py-2">{{ i + 1 }}</td>
              <td class="px-6 py-2">{{ medication.name }}</td>
              <td class="px-6 py-2">{{ medication.dose }}</td>
              <td class="px-6 py-2">{{ medication.frequency }}</td>
              <td class="px-6 py-2">{{ medication.noOfDays }}</td>
              <td class="px-6 py-2">{{ medication.remarks }}</td>
              <td class="px-6 py-2 text-red-600">
                <button (click)="medicalDiagnosis.medicines.pop()" class="btn btn-danger px-2 py-1" type="button">
                  <i class="fas fa-trash-alt"></i></button>
              </td>
            </tr>

            <tr>
              <td></td>
              <td><input [(ngModel)]="med.name" class="p-2 text-sm outline-blue-400" id="med1" name="name" pInputText
                         placeholder="medicine names"
                         required type="text"></td>
              <td>
                <input [(ngModel)]="med.dose" class="p-2 text-sm outline-blue-400" id="med2" min="1" name="dos"
                       pInputText
                       placeholder="Dosage" type="number"/>
              </td>
              <td class="w-full">
                <select [(ngModel)]="med.frequency" class="w-full p-2 text-sm rounded outline-blue-400" id="med3"
                        name="freq"
                        title="frequency">
                  <option value="1-1-1">1-1-1</option>
                  <option value="1-1-0">1-1-0</option>
                  <option value="1-0-1">1-0-1</option>
                  <option value="1-0-0">1-0-0</option>
                  <option value="0-1-1">0-1-1</option>
                  <option value="0-1-0">0-1-0</option>
                  <option value="0-0-1">0-0-1</option>
                </select>
              </td>
              <td>
                <input [(ngModel)]="med.noOfDays" class="p-2 text-sm outline-blue-400" id="med4" min="1" name="nod"
                       pInputText
                       placeholder="No.of Days" type="number">
              </td>
              <td>
                <input [(ngModel)]="med.remarks" class="p-2 text-sm outline-blue-400" id="remark" name="remarks"
                       pInputText
                       placeholder="remarks" type="text">
              </td>
              <td class="w-full flex justify-center">
                <button (click)="onMedicinesSave()" class="bg-amber-400 p-2 rounded text-black mx-auto" type="button">
                  <i class="fa fa-capsules"></i> Add
                </button>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
        <div class="tests mb-3 w-full">
          <div class="text-lg mb-3">Clinical Tests
            <hr>
          </div>

          <table class="w-full md:w-1/4 text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400 mb-2">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400 p-2">
            <th class="px-2 py-3">#</th>
            <th class="px-6 py-3">Test</th>
            <th class="px-3 py-3"></th>
            </thead>
            <tbody>
            <tr *ngFor="let test of medicalDiagnosis.tests;let i = index"
                class="odd:bg-white odd:dark:bg-zinc-300 even:bg-zinc-400 border-b text-black">
              <td class="px-2 py-3">{{ i + 1 }}</td>
              <td class="px-6 py-3">{{ test }}</td>
              <td class="px-3 py-3">
                <button (click)="medicalDiagnosis.tests.pop()" class="text-red-500 px-2 py-1"><i
                  class="fas fa-trash-alt"></i></button>
              </td>
            </tr>
            <tr class="text-black">
              <td></td>
              <td>
                <select [(ngModel)]="test" class="p-2 text-sm rounded outline-blue-400" id="clinical-test" name="name">
                  <option title="d" value="Chest X-Ray">Chest X-Ray</option>
                  <option value="CT Scan - Thoracic">CT Scan - Thoracic</option>
                  <option value="Urinalysis">Urinalysis</option>
                  <option value="Hemoglobin A1C">Hemoglobin A1C</option>
                  <option value="Complete Blood Count">Complete Blood Count</option>
                  <option value="Electrocardiogram">Electrocardiogram</option>
                  <option value="Coagulation Tests">Coagulation Tests</option>
                  <option value="Autoantibodies">Autoantibodies</option>
                  <option value="Electroencephalogram">Electroencephalogram</option>
                  <option value="Arthroscopy">Arthroscopy</option>
                </select>
              </td>
              <td>
                <a (click)="onTestSave()" class="bg-amber-300 ms-2 p-2 rounded">
                  <i class="fas fa-vial"></i>
                </a>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
        <div class="followup mb-3 w-full">
          <div class="text-lg mb-3">Follow Up
            <hr>
          </div>

          <table class="table table-nowrap mb-0">
            <tbody>
            <tr>
              <select [(ngModel)]="medicalDiagnosis.followup" class="p-2 w-full text-sm rounded" id="followup"
                      name="followup">
                <option value="After 1 Weeks">After 1 Week / SOS</option>
                <option value="After 2 Weeks">After 2 Week / SOS</option>
                <option value="After 3 Weeks">After 3 Week / SOS</option>
                <option value="After 1 month">After 1 Month / SOS</option>
              </select>
            </tr>
            </tbody>
          </table>
        </div>
        <div class="medical-files">
          <div class="text-lg mb-3">Lab Records/Results
            <hr>
          </div>
          <div class="input-group">
            <div (fileDropped)="onFileDrop($event)" appDnd class="flex flex-col items-center justify-center w-full"
                 id="lab_files">
              <label
                class="flex flex-col items-center justify-center w-full min-h-40 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer"
                for="dropzone-file">
                <div class="flex flex-col items-center justify-center pt-4 pb-4">
                  <svg aria-hidden="true" class="w-8 h-5 mb-4 text-gray-500 dark:text-gray-400"
                       fill="none" viewBox="0 0 20 16" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"
                      stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                      stroke-width="2"/>
                  </svg>
                  <p class="mb-2 text-sm text-gray-500 dark:text-gray-400"><span
                    class="font-semibold">Click to upload</span> or drag and drop</p>
                </div>
                <input (change)="onFilesSelected($event)" [multiple]="true" class="hidden" id="dropzone-file"
                       type="file"/>
                <div class="pb-2">
                  <div *ngFor="let f of selectedFiles">
                    <span class="text-xs text-gray-400">{{ f.name }} - {{ formatBytes(f.size) }}</span>
                  </div>
                </div>

              </label>

            </div>
          </div>
        </div>
        <div class="submit-btn flex justify-end my-3">
          <button class="bg-green-500 text-sm text-white p-2.5 rounded-md mt-2 hover:bg-green-400" pButton>Submit
            Medical Diagnosis
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<div *ngIf="!showDiagnose" class="consult m-3">
  <div class="h10 p-3">
    <div class="text-2xl font-bold">Patient Consultation</div>
    <hr>
  </div>
  <div class="pat-list w-full md:w-full xl:px-4 mx-auto">
    <p-table #dt1 [globalFilterFields]="['name','id','email','phone']"
             [paginator]="true"
             [rowsPerPageOptions]="[5,10,20]"
             [rows]="10"
             [showCurrentPageReport]="true" [tableStyle]="{ 'min-width': '50rem' }"
             [value]="appointments"
             currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
             styleClass="p-datatable-striped"
    >
      <ng-template pTemplate="caption">
        <div class="flex justify-end">
          <span class="p-input-icon-left">
                <i class="pi pi-search"></i>
                <input (input)="dt1.filterGlobal(getInput($event), 'contains')"
                       [placeholder]="'Search Patients'" pInputText
                       style="padding: 0.5rem 1px 0.5rem 2.5rem;font-weight: 400" type="text"/>
            </span>
        </div>
      </ng-template>
      <ng-template pTemplate="header">
        <tr>
          <th class="border">Patient Name</th>
          <th class="border">Appointment Time</th>
          <th class="border">Analysis</th>
          <th class="border">Action</th>
        </tr>
      </ng-template>
      <ng-template let-r pTemplate="body">
        <tr>
          <td class="border text-sm">{{ r.patient.name }}</td>
          <td class="border text-sm">{{ r.dateTime | date:'short' }}</td>
          <td class="border text-sm">
            <button
              class="p-button-success text-sm bg-violet-400 px-3 py-2 rounded-md text-zinc-50 hover:bg-violet-500">
              <i class="fa-solid fa-up-right-from-square pe-2"></i>View Analysis
            </button>
          </td>
          <td class="border text-sm">
            <button (click)="onDiagnose(r)"
                    class="p-button-success text-sm bg-blue-400 px-3 py-2 rounded-md text-zinc-50 hover:bg-blue-500">
              <i class="fa-solid fa-notes-medical pe-2"></i>Diagnose
            </button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="5">No Active Appointments found.</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
  <app-analysis-modal [analysis]="analysis" [showAnalysis]="false"></app-analysis-modal>

</div>

<app-progress-card></app-progress-card>
